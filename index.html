<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="style.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/8dce80eefe.js"
      crossorigin="anonymous"
    ></script>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather</title>
  </head>
  <body>
    <div class="container">
      <h1 id="weather">Current weather</h1>
      <h2>
        <div>
                <img src="https://openweathermap.org/img/wn/02n@2x.png" alt="Clear" id="icon" class="float-left" />
        </div>
        <div class="temperature">
          <div class="float-left">
            <span class="temperature" id="temperature">19</span
            ><span class="units">
              <a href="#" id="celsius-link">°C</a> |
              <a href="#" id="fahrenheit-link">°F</a>
            </span>
          </div>
        </div>
        <br />
        <div class="city"></div>
        <div id="today"></div>
      </h2>
      <p>Forecast in the next 5 days:</p>
      <div class="row">
        <div class="col-2">
          <i class="fa-solid fa-cloud-rain weather"></i>
          <br />
          <em> 19°/10° </em>
          <br />
          Tuesday
        </div>
        <div class="col-2">
          <i class="fa-solid fa-cloud-sun weather"></i>
          <br />
          <em> 22°/12° </em>
          <br />
          Wednesday
        </div>
        <div class="col-2">
          <i class="fa-solid fa-cloud-rain weather"></i>
          <br />
          <em> 20°/11° </em>
          <br />
          Thursday
        </div>
        <div class="col-2">
          <i class="fa-solid fa-cloud-sun weather"></i>
          <br />
          <em> 23°/14° </em>
          <br />
          Friday
        </div>
        <div class="col-2">
          <i class="fa-solid fa-cloud-sun weather"></i>
          <br />
          <em> 22°/13° </em>
          <br />
          Saturday
        </div>
      </div>
      <div class="col-12 mt-5">
        <form id="search-form">
          <input
            type="text"
            placeholder="Type a city"
            class="citySearch"
            autocomplete="off"
            autofocus="on"
            id="search-input"
          />
          <input type="submit" value="Search" class="citySearch" />
        </form>
        <button type="button" class="btn btn-success m-2" id="current">
          Current
        </button>
      </div>
      <p><a href="https://github.com/NatVoronianska/weather_app">Open-source code,</a>by Nat Voronjanska</p>
    </div>
    <script>
      let now = new Date();
      let today = document.querySelector("#today");
      let hours = now.getHours();
      let minutes = now.getMinutes();

      let days = [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ];
      let day = days[now.getDay()];

      today.innerHTML = `${day}, ${hours}:${minutes}`;

      function displayWeather(response) {
        let weatherDiv = document.querySelector("#weather");
        let temperature = Math.round(response.data.main.temp);
        let description = response.data.weather[0].description;
        let humid = response.data.main.humidity;
        let wind = response.data.wind.speed;
        weatherDiv.innerHTML = `It is ${temperature} degrees, ${description}, humidity: ${humid}, wind:${wind} in ${response.data.name}`;
        let temperatureDiv = document.querySelector("#temperature");
        temperatureDiv.innerHTML = temperature;
         let iconElement = document.querySelector("#icon");
        iconElement.setAttribute(
    "src",
    `http://openweathermap.org/img/wn/${response.data.weather[0].icon}@2x.png`
  );
  iconElement.setAttribute("alt", response.data.weather[0].description);
        console.log(temperature);

        function FF(event) {
          event.preventDefault();
          let temperatureEl = document.querySelector("#temperature");
          temperatureEl.innerHTML = temperature * 1.8 + 32;
        }

        function celsius(event) {
          event.preventDefault();
          let temperatureElement = document.querySelector("#temperature");
          temperatureElement.innerHTML = temperature;
        }
        let ffLink = document.querySelector("#fahrenheit-link");
        ffLink.addEventListener("click", FF);

        let celsiusLink = document.querySelector("#celsius-link");
        celsiusLink.addEventListener("click", celsius);
      }
      function search(event) {
        event.preventDefault();
        let city = document.querySelector("#search-input").value;
        let town = document.querySelector(".city");
        town.innerHTML = `${city}`;
        let key = "3dce9b1c66837262a25b3f448d354a76";
        let url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}&units=metric`;
        axios.get(url).then(displayWeather);
      }

      let searchForm = document.querySelector("#search-form");
      searchForm.addEventListener("submit", search);

      //bonus

      function displayCurrentWeather(response) {
        let weatherDiv = document.querySelector("h1");
        let temperature = Math.round(response.data.main.temp);
        let here = response.data.name;
        weatherDiv.innerHTML = `It is ${temperature} degrees in ${here}`;
        let temperatureElement = document.querySelector("#temperature");
        temperatureElement.innerHTML = temperature;
      
        function FF(event) {
          event.preventDefault();
          let temperatureEl = document.querySelector("#temperature");
          temperatureEl.innerHTML = temperature * 1.8 + 32;
        }

        function celsius(event) {
          event.preventDefault();
          let temperatureElement = document.querySelector("#temperature");
          temperatureElement.innerHTML = temperature;
        }
        let ffLink = document.querySelector("#fahrenheit-link");
        ffLink.addEventListener("click", FF);

        let celsiusLink = document.querySelector("#celsius-link");
        celsiusLink.addEventListener("click", celsius);
      }
      function showCurrentPosition(position) {
        let lat = position.coords.latitude;
        let lon = position.coords.longitude;
        let key = "3dce9b1c66837262a25b3f448d354a76";
        let url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${key}&units=metric`;
        console.log(url);
        axios.get(url).then(displayCurrentWeather);
      }
      function geo(event) {
        event.preventDefault();
        navigator.geolocation.getCurrentPosition(showCurrentPosition);
      }
      let currentWeather = document.querySelector("#current");
      currentWeather.addEventListener("click", geo);
    </script>
  </body>
</html>
